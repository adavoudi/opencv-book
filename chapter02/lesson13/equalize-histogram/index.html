<!DOCTYPE html>
<html lang="Farsi">
<head>

<title>پردازش تصویر در OpenCV | برابرسازی بافت‌نگار</title>

<meta charset="utf-8">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:type" content="website">
<meta property="og:title" content="">
<meta property="og:url" content="https://h4iku.github.io/opencv-book">
<meta property="og:site_name" content="پردازش تصویر در OpenCV">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="">
<meta name="twitter:description" content="">

  <link rel="short icon" href="/static/img/mira.png">
  <link href="/opencv-book/static/node_modules/bulma-rtl/css/bulma-rtl.css" rel="stylesheet">
  <link href="/opencv-book/static/zero60/style.css" rel="stylesheet">
  <link href="/opencv-book/static/zero60/agate.css" rel="stylesheet">
  <link href="https://cdn.rawgit.com/rastikerdar/sahel-font/v1.0.0-alpha13/dist/font-face.css" rel="stylesheet" type="text/css" />
 

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/contrib/auto-render.min.js"></script>

<!-- <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-MML-AM_CHTML' async></script> -->

</head>
<body>

  <header class="hero is-info columns">
    <div class="hero-body">
        <div class="container">
            <h1 class="title">
              <a href="/opencv-book">
                پردازش تصویر در OpenCV
              </a>
            </h1>
            <h2 class="subtitle"></h2>
        </div>
    </div>
    <span class="sidebar_toggle">
        <em class="open-icon"></em>
    </span>
</header>

  <section class="main-content columns is-fullheight">
    <aside id="sidebar" class="column is-one-quarter-desktop is-one-third-tablet section ">
  <div class="sidebar__inner">
    <ul class="menu-list">
        
        <li>
        
        
          <span class="season">فصل اول - معرفی</span>
          <ul>
        
            <li>
              <a href="/opencv-book/chapter01/lesson01/ocv-intro/">- معرفی اُ سی وی</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter01/lesson02/load-show-save/">- بارگذاری، نمایش و ذخیره تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter01/lesson03/mat-class/">- کلاس MAT</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter01/lesson04/store-retrieve/">- ذخیره سازی و بازیابی اطلاعات</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل دوم - حوزهٔ مکان</span>
          <ul>
        
            <li>
              <a href="/opencv-book/chapter02/lesson01/simple-shapes/">- شکل‌های هندسی ساده</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson02/linear-blend/">- ترکیب خطی دو تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson03/linear-filter/">- فیلتر خطی</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson04/affine-transformation/">- تبدیل اَفاین</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson05/map/">- نگاشت</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson06/contrast-brightness/">- تغییر کنتراست و روشنایی تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson07/smoothing/">- هموار سازی تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson08/border/">- اضافه کردن قاب به تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson09/drawing/">- مولد عدد تصادفی و ترسیم متن</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson10/zooming/">- بزرگ‌نمایی و کوچک‌نمایی تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson11/threshold/">- آستانه‌گذاری</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson12/image-histogram/">- بافت‌نگار تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson13/equalize-histogram/">- برابرسازی بافت‌نگار</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson14/sobel-operator/">- عملگر سابل</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson15/laplace-operator/">- عملگر لاپلاس</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson16/canny-operator/">- عملگر کَنی</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson17/contours/">- کانتورهای تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson18/convex-hull/">- پوش محدب</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson19/contours-frames/">- قاب‌های مستطیلی و دایره‌ای برای کانتورها</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson20/contours-rotated-frames/">- قاب‌های چرخیدهٔ مستطیلی و بیضوی برای کانتورها</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل سوم - حوزهٔ زمان</span>
          <ul>
        
            <li>
              <a href="/opencv-book/chapter03/lesson01/discrete-fourier/">- تبدیل فوریهٔ گسسته</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل چهارم - مورفولوژی</span>
          <ul>
        
            <li>
              <a href="/opencv-book/chapter04/lesson01/erode-dilate/">- فرسایش و گشایش</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter04/lesson02/morphology-transformations/">- تبدیل‌های مورفولوژی پیچیده</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل پنجم - شناسایی الگو</span>
          <ul>
        
            <li>
              <a href="/opencv-book/chapter05/lesson01/compare-histograms/">- مقایسه بافت‌نگارها</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter05/lesson02/back-projection/">- بَک پروجکشن</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter05/lesson03/pattern-matching/">- تطبیق الگو</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter05/lesson04/hough-line-transform/">- تبدیل خط هاف</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter05/lesson05/hough-circle-transform/">- تبدیل دایره هاف</a>
            </li>
        
        </ul>
        </li>
        
    </ul>
  </div>
</aside>

    <div class="container column">
        <div class="section" id="content">

  
      
          <h1 class="list">فصل دوم - حوزهٔ مکان</h1>
      

    <h3 class="list">برابرسازی بافت‌نگار</h3>

    <div class="content-body content">
    <a name="more"></a>
<p>همانطور که در بخش‌های قبل توضیح دادیم، بافت‌نگار تصویر یک نمایش گرافیکی از توزیع روشنایی آن تصویر است. این نمودار تعداد پیکسل‌هایی که یک مقدار روشنایی خاص را دارند، تعیین می‌کند.</p>

<table>
<col align="center" />
<thead>
<tr>
	<th><img src="/opencv-book/media/image71.png" alt="یک تصویر سیاه و سفید و بافت‌نگارآن" id="" /></th>
</tr>
</thead>
<tbody>
<tr>
	<td align="center">یک تصویر سیاه و سفید و بافت‌نگار آن</td>
</tr>
</tbody>
</table>

<p>برابرسازی بافت‌نگار روشی برای بهبود کنتراست تصویر است. این کار از طریق وسیع کردن برد روشنایی انجام می‌شود.</p>

<p>در شکل بالا می‌بینید که بیشتر پیکسل‌ها در دسته‌های میانی برد روشنایی قرار گرفته‌اند. کاری که برابرسازی بافت‌نگار انجام می‌دهد، وسیع کردن این برد است. به شکل زیر توجه کنید. در این شکل دایره‌های سبز رنگ نشان دهندهٔ نواحی کم پوشش هستند (یعنی پیکسل‌های کمتری دارای این مقادیر از روشنایی هستند). بعد از اعمال برابرسازی، بافت‌نگاری شبیه شکل میانی به دست می‌آید. تصویر سمت راست نتیجهٔ این برابرسازی است.</p>

<table>
<col align="center" />
<thead>
<tr>
	<th><img src="/opencv-book/media/image72.png" alt="فرایند برابرسازی بافت‌نگار یک تصویر – تصویر سمت راست برابرسازی است" id="" /></th>
</tr>
</thead>
<tbody>
<tr>
	<td align="center">فرایند برابرسازی بافت‌نگار یک تصویر – تصویر سمت راست برابرسازی است</td>
</tr>
</tbody>
</table>

<p>عملیات برابرسازی، یک توزیع را به یک توزیع وسیع‌تر و یکنواخت‌تر نگاشت می‌کند. پس مقادیر روشنایی، روی همهٔ بُرد موجود توزیع می‌شوند.</p>

<p>برای رسیدن به اهداف برابرسازی، تابع مورد استفاده برای برابرسازی باید از نوع تابع توزیع تجمعی<a href="#fn:a" id="fnref:a" class="footnote">1</a> (CDF) باشد. برای بافت‌نگار$H(i)$، توزیع تجمعی آن، یعنی $H'(i)$، به صورت زیر است:</p>

<p>$$H'\left( i \right) = \sum_{0 \leq j &lt; i}^{}{H(j)}$$</p>

<p>برای استفاده از این تابع به عنوان تابع نگاشت باید $H'(i)$ را به گونه‌ای نرمال سازی کنیم که مقادیر آن بین 0 تا 255 قرار بگیرند. برای مثال بالا، تابع تجمعی به صورت زیر می‌شود:</p>

<table>
<col align="center" />
<thead>
<tr>
	<th><img src="/opencv-book/media/image73.png" alt="تابع توزیع تجمعی بافت‌نگار تصویر سگ" id="" /></th>
</tr>
</thead>
<tbody>
<tr>
	<td align="center">تابع توزیع تجمعی بافت‌نگار تصویر سگ</td>
</tr>
</tbody>
</table>

<p>در انتها برای به دست آوردن مقادیر روشنایی تصویر برابرسازی شده، از یک نگاشت ساده استفاده می‌کنیم:</p>

<p>$$\text{equalized}\left( x,\ y \right) = H'\left( \text{src}\left( x,\ y \right) \right)$$</p>

<h2>کد</h2>

<pre><code class="language-c++">#include "opencv2/highgui/highgui.hpp"
#include "opencv2/imgproc/imgproc.hpp"
#include &lt;iostream&gt;
#include &lt;stdio.h&gt;

using namespace cv;
using namespace std;

/**  @function main */
int main( int argc, char** argv )
{
  Mat src, dst;

  char* source_window = "Source image";
  char* equalized_window = "Equalized Image";

  /// Load image
  src = imread( argv[1], 1 );

  if( !src.data )
    { cout&lt;&lt;"Usage: ./Histogram_Demo &lt;path_to_image&gt;"&lt;&lt;endl;
      return -1;}

  /// Convert to grayscale
  cvtColor( src, src, CV_BGR2GRAY );

  /// Apply Histogram Equalization
  equalizeHist( src, dst );

  /// Display results
  namedWindow( source_window, CV_WINDOW_AUTOSIZE );
  namedWindow( equalized_window, CV_WINDOW_AUTOSIZE );

  imshow( source_window, src );
  imshow( equalized_window, dst );

  /// Wait until user exits the program
  waitKey(0);

  return 0;
}
</code></pre>

<h2>توضیح</h2>

<p>در خط 25 تصویر ورودی را به یک تصویر سیاه و سفید تبدیل می‌کنیم.</p>

<p>در خط 28 با استفاده از تابع equalizeHist، عملیات برابرسازی بافت‌نگار را انجام می‌دهیم. این تابع دو آرگومان دارد که اولی تصویر ورودی و دومی تصویر خروجی است.</p>

<h2>خروجی</h2>

<p>از تصویر زیر که کنتراست کمی دارد به عنوان تصویر ورودی استفاده می‌کنیم:</p>

<table>
<col align="center" />
<col align="center" />
<thead>
<tr>
	<th><img src="/opencv-book/media/image74.png" alt="تصویر ورودی" id="" /></th>
	<th><img src="/opencv-book/media/image75.png" alt="بافت‌نگار تصویر ورودی" id="" /></th>
</tr>
</thead>
<tbody>
<tr>
	<td align="center">تصویر ورودی</td>
	<td align="center">بافت‌نگار تصویر ورودی</td>
</tr>
</tbody>
</table>

<p>بعد از اعمال برابرسازی نتیجه به صورت زیر می‌شود:</p>

<table>
<col align="center" />
<col align="center" />
<thead>
<tr>
	<th><img src="/opencv-book/media/image76.png" alt="تصویر خروجی" id="" /></th>
	<th><img src="/opencv-book/media/image77.png" alt="بافت‌نگار تصویر خروجی" id="" /></th>
</tr>
</thead>
<tbody>
<tr>
	<td align="center">تصویر خروجی</td>
	<td align="center">بافت‌نگار تصویر خروجی</td>
</tr>
</tbody>
</table>

<div class="footnotes">
<hr />
<ol>

<li id="fn:a"><p>Cumulative Distribution Function (CDF)<a href="#fnref:a" class="reversefootnote">&#160;&#8617;</a></p></li>

</ol>
</div>

    </div>
  


</div>

<div class="section">
    <nav class="pagination" role="navigation" aria-label="pagination">
    <a href="/opencv-book/chapter02/lesson12/image-histogram/" class="pagination-previous button is-primary is-outlined">
    →
    بافت‌نگار تصویر
  </a>




  <a href="/opencv-book/chapter02/lesson14/sobel-operator/" class="pagination-next button is-primary is-outlined">
    عملگر سابل
    ←
  </a>
    </nav>
</div>
    </div>

  </section>

  <footer class="columns hero section is-dark has-text-centered">
        <div class="container ">
            <div class="columns">

                <div class="column">
                    <div class="footer-header">
                       به این جاها سر بزنید
                    </div>
                    <ul class="related-links has-text-centered">
                        <li>
                            <a href="/opencv-book/pdf/opencv-book-v1.pdf" target="_blank">دریافت کتاب با فرمت پی‌دی‌اف</a>
                        </li>
                        <li>
                            <a href="https://github.com/h4iku/opencv-book/issues" target="_blank">گزارش مشکلات</a>
                        </li>
                    </ul>
                </div>
                <div class="column">
                    <div class="footer-header">
                    پردازش تصویر در OpenCV
                    </div>
                    <div class="socials">
                      <a href="/opencv-book">
                        <img class="cover" src="/opencv-book/media/cover-small.jpg">
                      </a>
                    </div>
                </div>


                </div>
            </div>
            <div class="has-text-centered credit">
              <div>
                ارائه شده بر بستر
                <a href="https://miraxy.github.io/doc-fa/" target="_blank">«میرا»</a>
                و قالب از
                <a href="https://dutymess.github.io/laravel-0-to-60/" target="_blank">
                «لاراول، از صفر تا شصت»
              </a>                
              </div>
            </div>
        </div>
    </footer>


    
<script type="text/javascript" src="/opencv-book/static/js/jquery.min.js"></script>
<script src="/opencv-book/static/js/highlight.pack.js"></script>
<script src="/opencv-book/static/js/highlightjs-line-numbers.min.js"></script>
<script src="/opencv-book/static/js/app.js"></script>

<script>
    renderMathInElement(document.body,{ delimiters:
      [
       {left: "$$", right: "$$", display: true},
       {left: "$", right: "$", display: false}
      ]
    });
</script>

<script>
    // Trim extra blank line of the codes
    var y = document.querySelectorAll("pre code");
    for(var i = 0; i < y.length; i++) {
      y[i].innerHTML = y[i].innerHTML.trimRight();
    }
</script>

</body>
</html>