<!DOCTYPE html>
<html lang="Farsi">
<head>

<title>پردازش تصویر در OpenCV | عملگر سابل</title>

<meta charset="utf-8">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:type" content="website">
<meta property="og:title" content="">
<meta property="og:url" content="https://h4iku.github.io/opencv-book">
<meta property="og:site_name" content="پردازش تصویر در OpenCV">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="">
<meta name="twitter:description" content="">

  <link rel="short icon" href="/static/img/mira.png">
  <link href="/opencv-book/static/node_modules/bulma-rtl/css/bulma-rtl.css" rel="stylesheet">
  <link href="/opencv-book/static/zero60/style.css" rel="stylesheet">
  <link href="/opencv-book/static/zero60/agate.css" rel="stylesheet">
  <link href="https://cdn.rawgit.com/rastikerdar/sahel-font/v1.0.0-alpha13/dist/font-face.css" rel="stylesheet" type="text/css" />
 

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/contrib/auto-render.min.js"></script>

<!-- <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-MML-AM_CHTML' async></script> -->

</head>
<body>

  <header class="hero is-info columns">
    <div class="hero-body">
        <div class="container">
            <h1 class="title">
              <a href="/opencv-book">
                پردازش تصویر در OpenCV
              </a>
            </h1>
            <h2 class="subtitle"></h2>
        </div>
    </div>
    <span class="sidebar_toggle">
        <em class="open-icon"></em>
    </span>
</header>

  <section class="main-content columns is-fullheight">
    <aside id="sidebar" class="column is-one-quarter-desktop is-one-third-tablet section ">
  <div class="sidebar__inner">
    <ul class="menu-list">
        
        <li>
        
        
          <span class="season">فصل اول - معرفی</span>
          <ul>
        
            <li>
              <a href="/opencv-book/chapter01/lesson01/ocv-intro/">- معرفی اُ سی وی</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter01/lesson02/load-show-save/">- بارگذاری، نمایش و ذخیره تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter01/lesson03/mat-class/">- کلاس MAT</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter01/lesson04/store-retrieve/">- ذخیره سازی و بازیابی اطلاعات</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل دوم - حوزهٔ مکان</span>
          <ul>
        
            <li>
              <a href="/opencv-book/chapter02/lesson01/simple-shapes/">- شکل‌های هندسی ساده</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson02/linear-blend/">- ترکیب خطی دو تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson03/linear-filter/">- فیلتر خطی</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson04/affine-transformation/">- تبدیل اَفاین</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson05/map/">- نگاشت</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson06/contrast-brightness/">- تغییر کنتراست و روشنایی تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson07/smoothing/">- هموار سازی تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson08/border/">- اضافه کردن قاب به تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson09/drawing/">- مولد عدد تصادفی و ترسیم متن</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson10/zooming/">- بزرگ‌نمایی و کوچک‌نمایی تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson11/threshold/">- آستانه‌گذاری</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson12/image-histogram/">- بافت‌نگار تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson13/equalize-histogram/">- برابرسازی بافت‌نگار</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson14/sobel-operator/">- عملگر سابل</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson15/laplace-operator/">- عملگر لاپلاس</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson16/canny-operator/">- عملگر کَنی</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson17/contours/">- کانتورهای تصویر</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson18/convex-hull/">- پوش محدب</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson19/contours-frames/">- قاب‌های مستطیلی و دایره‌ای برای کانتورها</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter02/lesson20/contours-rotated-frames/">- قاب‌های چرخیدهٔ مستطیلی و بیضوی برای کانتورها</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل سوم - حوزهٔ زمان</span>
          <ul>
        
            <li>
              <a href="/opencv-book/chapter03/lesson01/discrete-fourier/">- تبدیل فوریهٔ گسسته</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل چهارم - مورفولوژی</span>
          <ul>
        
            <li>
              <a href="/opencv-book/chapter04/lesson01/erode-dilate/">- فرسایش و گشایش</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter04/lesson02/morphology-transformations/">- تبدیل‌های مورفولوژی پیچیده</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل پنجم - شناسایی الگو</span>
          <ul>
        
            <li>
              <a href="/opencv-book/chapter05/lesson01/compare-histograms/">- مقایسه بافت‌نگارها</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter05/lesson02/back-projection/">- بَک پروجکشن</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter05/lesson03/pattern-matching/">- تطبیق الگو</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter05/lesson04/hough-line-transform/">- تبدیل خط هُو</a>
            </li>
        
        
            <li>
              <a href="/opencv-book/chapter05/lesson05/hough-circle-transform/">- تبدیل دایره هُو</a>
            </li>
        
        </ul>
        </li>
        
    </ul>
  </div>
</aside>

    <div class="container column">
        <div class="section" id="content">

  
      
          <h1 class="list">فصل دوم - حوزهٔ مکان</h1>
      

    <h3 class="list">عملگر سابل</h3>

    <div class="content-body content">
    <a name="more"></a>
<p>پیدا کردن مشتق‌های یک تصویر در کاربردهایی مثل یافتن لبه‌های موجود در تصویر مفید است.</p>

<table>
<col align="center" />
<thead>
<tr>
	<th><img src="/opencv-book/media/image78.png" alt="قسمت مشخص شده با دایره قرمز یک لبه است" id="" /></th>
</tr>
</thead>
<tbody>
<tr>
	<td align="center">قسمت مشخص شده با دایره قرمز یک لبه است</td>
</tr>
</tbody>
</table>

<p>به راحتی می‌توان دید که در یک لبه روشنایی پیکسل‌ها به شدت تغییر می‌کند. یکی از روش‌های توصیف تغییرات، مشتق‌ها هستند. یک تغییر زیاد در شیب، نماینگر یک تغییر قابل توجه در روشنایی تصویر است.</p>

<p>برای اینکه قضیه واضح‌تر شود، فرض کنید یک تصویر تک بعدی به صورت زیر داریم. محلی که با دایره قرمز مشخص شده است یک لبه است. این نقطه جایی است که تغییر قابل توجهی در شدت روشنایی دارد.</p>

<table>
<col />
<thead>
<tr>
	<th><img src="/opencv-book/media/image79.png" alt="یک تصویر یک بعدی- ناحیه مشخص شده با دایره قرمز یک لبه است" id="" /></th>
</tr>
</thead>
<tbody>
<tr>
	<td>یک تصویر یک بعدی - ناحیه مشخص شده با دایره قرمز یک لبه است</td>
</tr>
</tbody>
</table>

<p>می‌توان محل لبه‌ها را به راحتی با گرفتن مشتق اول پیدا کرد (در اینجا به شکل یک نقطهٔ بیشینه در آمده است).</p>

<table>
<col />
<thead>
<tr>
	<th><img src="/opencv-book/media/image80.png" alt="مشتق تصویر تک بعدی قبل" id="" /></th>
</tr>
</thead>
<tbody>
<tr>
	<td>مشتق تصویر تک بعدی قبل</td>
</tr>
</tbody>
</table>

<p>از توضیحات بالا نتیجه می‌گیریم که یک راه برای پیدا کردن لبه‌های تصویر این است که به دنبال پیکسل‌هایی بگردیم که گرادیانشان بیشتر از گرادیان همسایه‌هایشان (یا به طور کلی بیشتر از یک آستانه) است. در ادامه نحوه به دست آوردن گرداین تصویر را به کمک عملگر سابل بررسی می‌کنیم.</p>

<p><strong>عملگر سابل:</strong></p>

<p>عملگر سابل<a href="#fn:a" id="fnref:a" class="footnote">1</a> یک عملگر دیفرانسیلیِ گسسته است. این عملگر به طور تقریبی گرادیان تابع روشنایی عکس را حساب می‌کند.</p>

<p>عملگر سابل، دو عمل هموار سازی گوسی و دیفرانسیل گیری را با هم ترکیب می‌کند.</p>

<p>با فرض اینکه عکس مورد نظر I باشد، روند کار این عملگر به صورت زیر است:</p>

<ol>
<li><p>دو مشتق زیر را حساب می‌کند:</p>

<p>i. <strong>مشتق افقی:</strong> از طریق کانوالو I با کرنلی با اندازهٔ فرد به دست می‌آید. مثلاً برای کرنلی با اندازهٔ 3، $G_{x}$ (مشتق در راستای افقی) به شکل زیر به دست می‌آید:</p>

<p>$$
G_{x} = \begin{bmatrix}
    - 1 &amp; 0 &amp; + 1 \\
    - 2 &amp; 0 &amp; + 2 \\
    - 1 &amp; 0 &amp; + 1
\end{bmatrix}*I
$$</p>

<p>ii. <strong>مشتق عمودی:</strong> از طریق کانوالو I با کرنلی با اندازهٔ فرد به دست می‌آید. مثلاً برای کرنلی با اندازهٔ 3، $G_{y}$ (مشتق در راستای عمودی) به شکل زیر به دست می‌آید:</p>

<p>$$
G_{y} = \begin{bmatrix}
    - 1 &amp; - 2 &amp; - 1 \\
    0 &amp; 0 &amp; 0 \\
    + 1 &amp; + 2 &amp; + 1
\end{bmatrix}*I
$$</p></li>
<li><p>برای به دست آوردن گرادیان پیکسل‌های تصویر باید $G_{x}$ و $G_{y}$ را به شکل زیر با هم ترکیب کرد:</p>

<p>$$G = \sqrt{G_{x}^{2} + G_{y}^{2}}$$</p>

<p>البته بعضی اوقات از معادله ساده‌تر زیر هم استفاده می‌شود:</p>

<p>$$G = \left| G_{x} \right| + |G_{y}|$$</p></li>
</ol>

<p><strong>نکته: وقتی اندازهٔ کرنل 3 است، کرنل سابلی که در قسمت قبل نشان داده شد می‌تواند به صورت قابل توجه ای نتایج نادرست تولید کند (به هر حال سابل فقط یک تقریب برای مشتقات است). در اُ سی وی برای حل این مشکل تابع Scharr ارائه شده که به اندازهٔ سابل سریع است و البته در عین حال دقتی بسیار بیشتر از آن دارد. تابع Scharr از کرنل‌های زیر استفاده می‌کند:</strong></p>

<p>$$
\mathbf{G}_{\mathbf{x}}\mathbf{=}\begin{bmatrix}
\mathbf{- 3} &amp; \mathbf{0} &amp; \mathbf{+ 3} \\
\mathbf{- 10} &amp; \mathbf{0} &amp; \mathbf{+ 10} \\
\mathbf{- 3} &amp; \mathbf{0} &amp; \mathbf{+ 3}
\end{bmatrix}
$$</p>

<p>$$
\mathbf{G}_{\mathbf{y}}\mathbf{=}\begin{bmatrix}
\mathbf{- 3} &amp; \mathbf{- 10} &amp; \mathbf{- 3} \\
\mathbf{0} &amp; \mathbf{0} &amp; \mathbf{0} \\
\mathbf{+ 3} &amp; \mathbf{+ 10} &amp; \mathbf{+ 3}
\end{bmatrix}
$$</p>

<h2>کد</h2>

<pre><code class="language-c++">#include "opencv2/imgproc/imgproc.hpp"
#include "opencv2/highgui/highgui.hpp"
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;

using namespace cv;

/** @function main */
int main( int argc, char** argv )
{

    Mat src, src_gray;
    Mat grad;
    char* window_name = "Sobel Demo - Simple Edge Detector";
    int scale = 1;
    int delta = 0;
    int ddepth = CV_16S;

    int c;

    /// Load an image
    src = imread( argv[1] );

    if( !src.data )
    { return -1; }

    GaussianBlur( src, src, Size(3,3), 0, 0, BORDER_DEFAULT );

    /// Convert it to gray
    cvtColor( src, src_gray, CV_RGB2GRAY );

    /// Create window
    namedWindow( window_name, CV_WINDOW_AUTOSIZE );

    /// Generate grad_x and grad_y
    Mat grad_x, grad_y;
    Mat abs_grad_x, abs_grad_y;

    /// Gradient X
    //Scharr( src_gray, grad_x, ddepth, 1, 0, scale, delta, BORDER_DEFAULT );
    Sobel( src_gray, grad_x, ddepth, 1, 0, 3, scale, delta, BORDER_DEFAULT );
    convertScaleAbs( grad_x, abs_grad_x );

    /// Gradient Y
    //Scharr( src_gray, grad_y, ddepth, 0, 1, scale, delta, BORDER_DEFAULT );
    Sobel( src_gray, grad_y, ddepth, 0, 1, 3, scale, delta, BORDER_DEFAULT );
    convertScaleAbs( grad_y, abs_grad_y );

    /// Total Gradient (approximate)
    addWeighted( abs_grad_x, 0.5, abs_grad_y, 0.5, 0, grad );

    imshow( window_name, grad );

    waitKey(0);

    return 0;
}
</code></pre>

<h2>توضیح</h2>

<p>در خط 27 برای کاهش نویز یک هموار سازی گوسی به تصویر ورودی اعمال می‌کنیم (با اندازه کرنل 3).</p>

<p>در خطوط 41 و 46 به ترتیب مشتقات در جهت‌های x و y را حساب می‌کنیم. برای این کار از تابع Sobel استفاده می‌کنیم. این تابع 9 آرگومان به شرح زیر دارد:</p>

<ol>
<li><strong>src_gray:</strong> تصویر ورودی است. در اینجا از نوع CV_8U است.</li>
<li><strong>grad_x/grad_y:</strong> تصویر خروجی</li>
<li><strong>ddepth:</strong> عمق تصویر خروجی است. برای جلوگیری از سرریز از CV_16S استفاده می‌کنیم.</li>
<li><strong>x_order:</strong> مرتبهٔ مشتق در جهت x است.</li>
<li><strong>y_order:</strong> مرتبهٔ مشتق در جهت y است.</li>
<li><strong>scale، delta و BORDER_DEFAULT:</strong> از مقادیر پیش‌فرض استفاده می‌کنیم.</li>
</ol>

<p>توجه کنید که برای به دست آوردن گرادیان در جهت x باید $x_{\text{order}} = 1$ و $y_{\text{order}} = 0$ قرار دهیم. برعکس این کار را برای جهت y انجام می دهیم.</p>

<p>در خطوط 42 و 47، نتایج جزئی را به نوع CV_8U تبدیل می‌کنیم.</p>

<p>سرانجام در خط 50 برای تخمین گرادیان کلی، گردایان در جهت‌های x و y را با هم جمع می‌کنیم (توجه کنید که این کار اصلاً یک محاسبه دقیق نیست!! ولی کار ما را راه می‌اندازد).</p>

<h2>خروجی</h2>

<table>
<col align="center" />
<col align="center" />
<thead>
<tr>
	<th><img src="/opencv-book/media/image81.png" alt="تصویر ورودی" id="" /></th>
	<th><img src="/opencv-book/media/image82.png" alt="تصویر خروجی" id="" /></th>
</tr>
</thead>
<tbody>
<tr>
	<td align="center">تصویر ورودی</td>
	<td align="center">تصویر خروجی</td>
</tr>
</tbody>
</table>

<div class="footnotes">
<hr />
<ol>

<li id="fn:a"><p>Sobel<a href="#fnref:a" class="reversefootnote">&#160;&#8617;</a></p></li>

</ol>
</div>

    </div>
  


</div>

<div class="section">
    <nav class="pagination" role="navigation" aria-label="pagination">
    <a href="/opencv-book/chapter02/lesson13/equalize-histogram/" class="pagination-previous button is-primary is-outlined">
    →
    برابرسازی بافت‌نگار
  </a>




  <a href="/opencv-book/chapter02/lesson15/laplace-operator/" class="pagination-next button is-primary is-outlined">
    عملگر لاپلاس
    ←
  </a>
    </nav>
</div>
    </div>

  </section>

  <footer class="columns hero section is-dark has-text-centered">
        <div class="container ">
            <div class="columns">

                <div class="column">
                    <div class="footer-header">
                       به این جاها سر بزنید
                    </div>
                    <ul class="related-links has-text-centered">
                        <li>
                            <a href="/opencv-book/pdf/opencv-book-v1.pdf" target="_blank">دریافت کتاب با فرمت پی‌دی‌اف</a>
                        </li>
                        <li>
                            <a href="https://github.com/h4iku/opencv-book/issues" target="_blank">گزارش مشکلات</a>
                        </li>
                    </ul>
                </div>
                <div class="column">
                    <div class="footer-header">
                    پردازش تصویر در OpenCV
                    </div>
                    <div class="socials">
                      <a href="/opencv-book">
                        <img class="cover" src="/opencv-book/media/cover-small.jpg">
                      </a>
                    </div>
                </div>


                </div>
            </div>
            <div class="has-text-centered credit">
              <div>
                ارائه شده بر بستر
                <a href="https://miraxy.github.io/doc-fa/" target="_blank">«میرا»</a>
                و قالب از
                <a href="https://dutymess.github.io/laravel-0-to-60/" target="_blank">
                «لاراول، از صفر تا شصت»
              </a>                
              </div>
            </div>
        </div>
    </footer>


    
<script type="text/javascript" src="/opencv-book/static/js/jquery.min.js"></script>
<script src="/opencv-book/static/js/highlight.pack.js"></script>
<script src="/opencv-book/static/js/highlightjs-line-numbers.min.js"></script>
<script src="/opencv-book/static/js/app.js"></script>

<script>
    renderMathInElement(document.body,{ delimiters:
      [
       {left: "$$", right: "$$", display: true},
       {left: "$", right: "$", display: false}
      ]
    });
</script>

<script>
    // Trim extra blank line of the codes
    var y = document.querySelectorAll("pre code");
    for(var i = 0; i < y.length; i++) {
      y[i].innerHTML = y[i].innerHTML.trimRight();
    }
</script>

</body>
</html>